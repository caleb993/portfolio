<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Muga â€¢ TechKnow Solutionsâ€” Caleb Muga</title>

  <!-- SEO / OpenGraph -->
  <meta name="description" content="TechKnow Solutions â€” Caleb Muga: ICT Support, Networking, Cybersecurity, and process automation. Contact for services and view portfolio.">
  <meta name="author" content="Caleb Muga">
  <meta property="og:title" content="TechKnow Solutions â€” Caleb Muga">
  <meta property="og:description" content="ICT Support, Networking, Cybersecurity and automation solutions.">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="TechKnow Solutions">
  {% if hero_url %}
  <meta property="og:image" content="{{ hero_url }}">
  {% endif %}

  <!-- âœ… Always fallback to your personal profile image -->
  <meta property="og:image:alt" content="Profile photo of Caleb Muga">
  <meta property="og:image" content="https://otxksqyjllidcsgyreve.supabase.co/storage/v1/object/public/media/profile/20250902_144247_IMG_20240214_081320_transcpr2.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://otxksqyjllidcsgyreve.supabase.co/storage/v1/object/public/media/profile/20250902_144247_IMG_20240214_081320_transcpr2.jpg">

  <!-- âœ… Structured data for Google -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Caleb Muga",
    "url": "https://muga.portfolio",
    "image": "https://otxksqyjllidcsgyreve.supabase.co/storage/v1/object/public/media/profile/20250902_144247_IMG_20240214_081320_transcpr2.jpg",
    "jobTitle": "ICT Support & Cybersecurity",
    "worksFor": {
      "@type": "Organization",
      "name": "TechKnow Solutions"
    }
  }
  </script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* your CSS stays the same */

    :root{ --brand1:#0d6efd; --brand2:#6f42c1; --muted:#6b7280; }
    * { box-sizing: border-box; }
    body{
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#0b1220; color:#e6eef8; min-height:100vh; display:flex; flex-direction:column; overflow-x:hidden;
      transition: background .25s, color .25s;
    }
    /* LIGHT MODE */
    body.light { background: #f5f7fb; color: #0b1220; }
    .navbar{ font-size:1.05rem; backdrop-filter: saturate(160%) blur(6px); }
    .brand-avatar{ display:flex; align-items:center; gap:10px; text-decoration:none; font-weight:800; letter-spacing:.2px; }
    .brand-avatar img{ width:38px; height:38px; border-radius:50%; object-fit:cover; box-shadow:0 0 0 3px rgba(255,255,255,.15); }
    .brand-avatar span { color:#e5e7eb; }
    body.light .brand-avatar span { color: #0b1220; }
    .hero{ position:relative; color:#fff; padding:140px 24px 120px; text-align:center; border-bottom-left-radius:24px; border-bottom-right-radius:24px; overflow:hidden; }
    body.light .hero{ color:#0b1220; }
    .hero .overlay { position:absolute; inset:0; z-index:0; opacity:.28; background-size:cover; background-position:center; filter:saturate(120%) contrast(105%); }
    .hero h1{ position:relative; z-index:1; font-weight:800; font-size:3.2rem; letter-spacing:.3px; }
    .hero p{ position:relative; z-index:1; font-size:1.25rem; opacity:.95; }
    .chip{ display:inline-block; background:rgba(255,255,255,.12); padding:.35rem .7rem; border-radius:999px; font-size:.95rem; margin:0 .25rem .5rem; border:1px solid rgba(255,255,255,.2) }
    body.light .chip { background: rgba(10,10,10,.04); color:#0b1220; border:1px solid rgba(0,0,0,.06); }
    .floaters span{ position:absolute; width:120px; height:120px; border-radius:50%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.12), rgba(255,255,255,.02)); animation: drift 16s ease-in-out infinite; filter: blur(1px); }
    .floaters span:nth-child(1){ left:5%; top:40%; animation-delay:0s; }
    .floaters span:nth-child(2){ right:8%; top:20%; animation-delay:2s; width:160px; height:160px; }
    .floaters span:nth-child(3){ left:20%; bottom:10%; animation-delay:4s; width:90px; height:90px; }
    .floaters span:nth-child(4){ right:20%; bottom:15%; animation-delay:6s; width:110px; height:110px; }
    @keyframes drift{ 0%,100%{ transform: translateY(0) translateX(0); } 50%{ transform: translateY(-18px) translateX(8px); } }
    section{ padding:80px 0; }
    h2.section-title{ font-weight:800; font-size:2rem; text-align:center; margin-bottom:24px; }
    .lead-lg{ font-size:1.15rem; color:#d0d8e6; }
    body.light .lead-lg { color: #374151; }
    .card{ border:0; border-radius:18px; background:#0f1724; box-shadow:0 8px 24px rgba(0,0,0,.55); color:#e6eef8; }
    body.light .card { background: #fff; color: #0b1220; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    .form-control, .form-select{ background:#0c1426; border:1px solid #1d2b4a; color:#dbe6ff; border-radius:12px; }
    body.light .form-control, body.light .form-select { background: #fff; color:#0b1220; border:1px solid #e6eef8; }
    .btn-primary{ background:linear-gradient(135deg, var(--brand1), var(--brand2)); border:0; }
    .gallery-grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:14px; }
    .gallery-item{ position:relative; border-radius:14px; overflow:hidden; background:#0c1426; cursor:pointer; display:flex; align-items:center; justify-content:center; height:180px; }
    .gallery-item img, .gallery-item video{ width:100%; height:100%; object-fit:cover; transition: transform .4s ease; display:block; }
    .gallery-item:hover img, .gallery-item:hover video{ transform: scale(1.05); }
    .video-overlay { position:absolute; z-index:5; display:flex; align-items:center; justify-content:center; pointer-events:none; }
    .video-play-icon { width:56px; height:56px; background: rgba(0,0,0,0.45); border-radius:50%; display:flex; align-items:center; justify-content:center; }
    .video-play-icon:after{ content:""; border-style:solid; border-width:10px 0 10px 16px; border-color: transparent transparent transparent #fff; margin-left:4px; display:inline-block; }
    .reveal{ opacity:0; transform: translateY(18px); transition: all .7s ease; }
    .reveal.visible{ opacity:1; transform: translateY(0); }
    #loader{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:#0b1220; z-index:9999; }
    .spinner{ width:56px; height:56px; border-radius:50%; border:6px solid rgba(255,255,255,.15); border-top-color:#8aa4ff; animation:spin 1s linear infinite; }
    @keyframes spin{ to{ transform: rotate(360deg); } }
    .blog-card { padding:18px; border-radius:12px; background: rgba(255,255,255,0.02); }
    body.light .blog-card { background: #fff; border:1px solid #eef2ff; }
    .top-right-controls { display:flex; gap:8px; align-items:center; }
    .dark-toggle { cursor:pointer; border-radius:999px; padding:.35rem .6rem; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.06); color:inherit; }
    body.light .dark-toggle { background: rgba(0,0,0,.03); }
    /* small responsive tweak for video thumbnails */
    @media (max-width:576px){ .gallery-item { height:140px; } }
  </style>
</head>
<body>

<div id="loader" role="status" aria-hidden="false"><div class="spinner" aria-hidden="true"></div></div>

<nav class="navbar navbar-expand-lg bg-transparent sticky-top" role="navigation" aria-label="Main navigation">
  <div class="container">
    <a class="brand-avatar" href="#home" aria-label="Go to home">
      {% if profile_url %}
        <img src="{{ profile_url }}" alt="profile">
        <span>Muga.dev</span>
      {% else %}
        <span class="fs-5">Muga<span style="color:#8aa4ff">.dev</span></span>
      {% endif %}
    </a>

    <div class="top-right-controls ms-auto d-flex align-items-center">
      <button id="themeBtn" class="dark-toggle" title="Toggle light / dark" aria-pressed="false">Toggle theme</button>
      <a class="btn btn-sm btn-outline-primary ms-2" href="{{ url_for('blog_list') }}">Blog</a>
      <a class="btn btn-sm btn-outline-secondary ms-2" href="{{ url_for('login') }}">Admin</a>
    </div>
  </div>
</nav>

<header id="home" class="hero" role="banner">
  {% if hero_url %}
    <div class="overlay" style="background-image: url('{{ hero_url }}');" aria-hidden="true"></div>
  {% endif %}
  <div class="floaters" aria-hidden="true">
    <span></span><span></span><span></span><span></span>
  </div>
  <div class="container position-relative">
    <h1 class="reveal">Hey, WELCOME TO TECHKNOW SOLUTIONS - Caleb Muga ðŸ‘‹</h1>
    <p class="mt-3 reveal" style="max-width:900px;margin:0 auto;">
      <span class="chip" aria-hidden="true">ICT Support</span>
      <span class="chip" aria-hidden="true">Networking</span>
      <span class="chip" aria-hidden="true">Cybersecurity</span>
      <span class="chip" aria-hidden="true">Process Automation</span>
    </p>
    <a href="#portfolio" class="btn btn-primary btn-lg mt-4 reveal">See My Work</a>
  </div>
</header>

<main class="container flex-grow-1" role="main">
  {% with msgs=get_flashed_messages() %}
    {% if msgs %}
      <div class="mt-4" aria-live="polite">
        {% for m in msgs %}
          <div class="alert alert-info">{{ m }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- About -->
  <section id="about" class="reveal" aria-labelledby="about-title">
    <h2 class="section-title" id="about-title">About Me</h2>
    <div class="card p-4 mx-auto" style="max-width:1000px">
      <div class="row g-4">
        <div class="col-md-4 text-center">
          {% if profile_url %}
            <img src="{{ profile_url }}" style="width:160px;height:160px;object-fit:cover;border-radius:12px;" alt="Profile image of Caleb Muga">
          {% else %}
            <div style="width:160px;height:160px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:#0c1426;font-weight:700;font-size:28px;" aria-hidden="true">
              CM
            </div>
          {% endif %}
        </div>
        <div class="col-md-8">
          <p class="lead-lg">
            Customer-focused ICT Officer with a BSc in Business & IT. Practical experience in network administration, end-user support,
            and cybersecurity. I build reliable tools and automate repetitive tasks to increase efficiency.
          </p>
          <ul>
            <li><strong>Strengths:</strong> Problem-solving, documentation, stakeholder communication, systems hardening.</li>
            <li><strong>Certifications:</strong> CCNA 1,OPSWAT File Security Associate, ALX Virtual Assistant.</li>
            <li><strong>Languages:</strong> English, Swahili.</li>
          </ul>
          {% if cv_file %}
            <a href="{{ url_for('download_file', kind='cv', filename=cv_file) }}" class="btn btn-outline-primary">Download CV</a>
          {% endif %}
        </div>
      </div>
    </div>
  </section>

  <!-- Portfolio / Gallery -->
  <section id="portfolio" class="reveal" aria-labelledby="portfolio-title">
    <h2 class="section-title" id="portfolio-title">Portfolio & Gallery</h2>
    <p class="text-center lead-lg">Featured gallery and private project submission.</p>

    <div class="card p-3 mb-4" aria-live="polite">
      <h5 class="mb-3">Featured Gallery ({{ gallery_images|length }})</h5>
      {% if gallery_images %}
        <div class="gallery-grid">
          {% for g in gallery_images %}
            <div class="gallery-item" onclick="openGalleryItem({{ loop.index0 }})" role="button" tabindex="0" aria-label="Open gallery item {{ loop.index }}">
              {% if g.type == 'image' %}
                <img src="{{ g.url }}" alt="Gallery image {{ loop.index }}">
              {% elif g.type == 'video' %}
                <video muted playsinline preload="metadata" aria-hidden="true">
                  <source src="{{ g.url }}">
                </video>
                <div class="video-overlay" aria-hidden="true"><div class="video-play-icon"></div></div>
              {% else %}
                <img src="{{ g.url }}" alt="Gallery {{ loop.index }}">
              {% endif %}
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted mb-0">Gallery is empty. (Admin can add photos or videos in the Admin Panel.)</p>
      {% endif %}
    </div>

    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Submit Your Project (Private)</h5>
        <p class="text-muted mb-2">Your file is uploaded privately and only the admin can view/approve it.</p>
        <form method="post" enctype="multipart/form-data" action="{{ url_for('upload_project') }}">
          <input type="file" name="file" class="form-control mb-2" required aria-label="Choose file to upload">
          <button class="btn btn-primary">Upload</button>
        </form>
        <small class="text-muted d-block mt-2">Allowed: {{ allowed_exts|join(', ') }} â€¢ up to 32MB</small>
      </div>
    </div>
  </section>

  <!-- Newsletter (Phase 1 addition) -->
  <section id="newsletter" class="reveal" aria-labelledby="newsletter-title">
    <h2 class="section-title" id="newsletter-title">Stay Updated</h2>
    <p class="text-center lead-lg">Subscribe to occasional updates and new blog posts.</p>
    <div class="card p-3 mx-auto" style="max-width:720px">
      <form method="post" action="{{ url_for('subscribe') }}" class="d-flex gap-2 align-items-center" aria-label="Subscribe to newsletter">
        <label for="sub-email" class="visually-hidden">Email address</label>
        <input id="sub-email" type="email" name="email" class="form-control" placeholder="Email address" required>
        <button class="btn btn-primary">Subscribe</button>
      </form>
      <div class="small text-muted mt-2">No spam. Unsubscribe anytime by contacting admin.</div>
    </div>
  </section>

  <!-- Services -->
  <section id="services" class="reveal">
    <h2 class="section-title">Services</h2>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card h-100 p-3">
          <h5>Network Administration</h5>
          <p class="mb-0">Design, deploy and maintain reliable networks (LAN/WAN, switches, routers, VPNs).</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100 p-3">
          <h5>Cybersecurity</h5>
          <p class="mb-0">Vulnerability scanning, hardening, access control and incident response support.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100 p-3">
          <h5>Automation & Data Solutions</h5>
          <p class="mb-0">Dashboards, scripts and small automations that save time and reduce errors.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Blog preview -->
  <section id="blog" class="reveal">
    <h2 class="section-title">Latest from my blog</h2>
    <div class="row g-4">
      {% if blog_posts %}
        {% for b in blog_posts[:3] %}
          <div class="col-md-4">
            <div class="blog-card">
              <h5>{{ b.title }}</h5>
              <div class="text-muted" style="font-size:.9rem">{{ b.timestamp }}</div>
              <p style="margin-top:.6rem; color:inherit;">{{ b.content[:180] }}{% if b.content|length > 180 %}...{% endif %}</p>
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('view_blog', slug=b.slug) }}">Read</a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="col-12"><p class="text-muted">No blog posts yet. (Admin can add posts.)</p></div>
      {% endif %}
    </div>
    <div class="text-center mt-3"><a class="btn btn-outline-secondary" href="{{ url_for('blog_list') }}">See all posts</a></div>
  </section>

  <!-- Contact -->
  <section id="contact" class="reveal">
    <h2 class="section-title">Contact</h2>
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">Send a Message</h5>
            <form method="post" action="{{ url_for('contact') }}">
              <input type="text" name="name" class="form-control mb-2" placeholder="Your name" required>
              <input type="email" name="email" class="form-control mb-2" placeholder="Your email" required>
              <textarea name="message" class="form-control mb-2" rows="4" placeholder="Your message" required></textarea>
              <button class="btn btn-primary">Send</button>
            </form>
            <small class="text-muted d-block mt-2">Your message is saved privately (admin can view).</small>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">Quick Contacts</h5>
            <p class="lead mb-1"><strong>Phone:</strong> 0791 204 587</p>
            <a class="btn btn-whatsapp btn-lg" href="https://wa.me/254791204587" target="_blank" rel="noopener">Chat on WhatsApp</a>
            <p class="text-muted mt-3 mb-0">Available Monâ€“Sat. Nairobi time (EAT).</p>
          </div>
        </div>
      </div>
    </div>
  </section>

</main>

<footer>
  <div class="container d-flex flex-wrap justify-content-between align-items-center py-3">
    <div>Â© {{ year }} <strong>Caleb Muga</strong>. All rights reserved.</div>
    <div><a class="text-decoration-none" href="#home">Back to top â†‘</a></div>
  </div>
</footer>

<!-- Media modal (images & videos) -->
<div class="modal fade" id="mediaModal" tabindex="-1" aria-hidden="true" aria-labelledby="mediaModalLabel">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content" style="background:transparent;border:0;">
      <div class="modal-body p-0">
        <div id="mediaContainer" style="width:100%;height:auto;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:transparent;">
          <!-- JS injects media -->
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Loader
  window.addEventListener('load', () => {
    const l = document.getElementById('loader');
    if(l){ l.style.opacity = '0'; setTimeout(() => l.style.display='none', 300); }
  });

  // Reveal on scroll
  const io = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      if(e.isIntersecting){ e.target.classList.add('visible'); }
    });
  }, { threshold:.12 });
  document.querySelectorAll('.reveal').forEach(el => io.observe(el));

  // Gallery items as array
  const galleryItems = {{ gallery_images|tojson }};

  function openGalleryItem(idx){
    if(!galleryItems || idx < 0 || idx >= galleryItems.length) return;
    const it = galleryItems[idx];
    const container = document.getElementById('mediaContainer');
    container.innerHTML = '';
    if(it.type === 'image'){
      const img = document.createElement('img');
      img.src = it.url;
      img.alt = 'Gallery image';
      img.style.width = '100%';
      img.style.height = 'auto';
      img.style.display = 'block';
      img.style.borderRadius = '12px';
      container.appendChild(img);
    } else if(it.type === 'video'){
      const vid = document.createElement('video');
      vid.src = it.url;
      vid.controls = true;
      vid.autoplay = false;
      vid.playsInline = true;
      vid.style.width = '100%';
      vid.style.height = 'auto';
      vid.style.display = 'block';
      vid.style.borderRadius = '12px';
      container.appendChild(vid);
    } else {
      const a = document.createElement('a');
      a.href = it.url;
      a.innerText = 'Open media';
      a.target = '_blank';
      container.appendChild(a);
    }
    const modalEl = document.getElementById('mediaModal');
    const modal = new bootstrap.Modal(modalEl);
    modal.show();
  }

  // Theme toggle (persist in localStorage)
  const themeKey = 'muga_theme';
  const themeBtn = document.getElementById('themeBtn');
  function applyTheme(t){
    if(t==='light') {
      document.body.classList.add('light');
      themeBtn.setAttribute('aria-pressed', 'true');
    } else {
      document.body.classList.remove('light');
      themeBtn.setAttribute('aria-pressed', 'false');
    }
  }
  function initTheme(){
    const t = localStorage.getItem(themeKey) || 'dark';
    applyTheme(t);
  }
  initTheme();
  themeBtn.addEventListener('click', () => {
    const t = document.body.classList.contains('light') ? 'dark' : 'light';
    localStorage.setItem(themeKey, t);
    applyTheme(t);
  });

  // keyboard accessibility for gallery items (Enter to open)
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && document.activeElement && document.activeElement.classList.contains('gallery-item')){
      const nodeList = Array.from(document.querySelectorAll('.gallery-item'));
      const idx = nodeList.indexOf(document.activeElement);
      if(idx >= 0) openGalleryItem(idx);
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
